<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 1 - Your Wish</title>
    <style>
        body { 
            background: #05070a; 
            color: #e2e8f0; 
            font-family: 'Segoe UI', sans-serif; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .card {
            text-align: center;
            padding: 40px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h2 { margin-bottom: 20px; color: #fff; }

        textarea { 
            width: 100%; 
            height: 120px; 
            padding: 15px; 
            border-radius: 12px; 
            border: 1px solid #334155; 
            background: #0f172a; 
            color: white; 
            font-size: 1rem;
            resize: none;
            box-sizing: border-box;
            outline: none;
        }
        
        textarea:focus { border-color: #6366f1; }

        button { 
            margin-top: 25px;
            padding: 12px 40px; 
            background: #6366f1; 
            color: white; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 600;
            transition: 0.3s;
        }

        button:hover { background: #4f46e5; transform: scale(1.05); }
    </style>
</head>
<body>

    <div class="card">
        <h2 id="greeting">Hello...</h2>
        <p>What is your deepest wish for the stars tonight?</p>
        <textarea id="wishInput" placeholder="Write your wish here..."></textarea>
        <br>
        <button onclick="saveWish()">Next Step</button>
    </div>

    <script type="module">
        // 1. Import Firebase functions from CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // 2. Your specific Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCFwrqG63P6fo-DNtansqfe73zpy_yJ1jA",
            authDomain: "celestialcanvas-cac1e.firebaseapp.com",
            databaseURL: "https://celestialcanvas-cac1e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "celestialcanvas-cac1e",
            storageBucket: "celestialcanvas-cac1e.firebasestorage.app",
            messagingSenderId: "957600979058",
            appId: "1:957600979058:web:0fd4ca1ede86ae19e40aeb"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 4. Retrieve the name from index.html
        const visitorName = localStorage.getItem('visitorName');
        
        if (visitorName) {
            document.getElementById('greeting').innerText = "Hello, " + visitorName;
        } else {
            // If someone skips the login, send them back
            window.location.href = "index.html";
        }

        // 5. Function to save to database
        window.saveWish = function() {
            const wishText = document.getElementById('wishInput').value;

            if (wishText.trim() === "") {
                alert("Please share your wish with the universe.");
                return;
            }

            // Reference to results/[Name]
            const userRef = ref(db, 'results/' + visitorName);

            // 'set' creates the user's data for the first time
            set(userRef, {
                name: visitorName,
                wish: wishText,
                timestamp: new Date().toLocaleString()
            }).then(() => {
                // Once saved, go to next page
                window.location.href = "question2.html";
            }).catch((error) => {
                console.error("Firebase Error:", error);
                alert("Database connection failed. Check your Firebase rules.");
            });
        };
    </script>
</body>
</html>